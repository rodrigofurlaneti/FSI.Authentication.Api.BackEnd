ðŸ“¦ src
 â”œâ”€â”€ Clients
 â”‚    â”œâ”€â”€ Web
 â”‚    â”œâ”€â”€ Mobile
 â”‚    â””â”€â”€ Partner
 â”‚
 â”œâ”€â”€ Presentation
 â”‚    â”œâ”€â”€ Controllers
 â”‚    â”‚    â”œâ”€â”€ Users
 â”‚    â”‚    â”œâ”€â”€ Expenses
 â”‚    â”‚    â”œâ”€â”€ Categories
 â”‚    â”‚    â”œâ”€â”€ Transactions
 â”‚    â”‚    â”œâ”€â”€ Auth
 â”‚    â”‚    â”œâ”€â”€ Admin
 â”‚    â”‚    â””â”€â”€ Base
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Filters
 â”‚    â”‚    â”œâ”€â”€ ExceptionFilters
 â”‚    â”‚    â”œâ”€â”€ ValidationFilters
 â”‚    â”‚    â”œâ”€â”€ ActionFilters
 â”‚    â”‚    â”œâ”€â”€ AuthorizationFilters
 â”‚    â”‚    â””â”€â”€ ResultFilters
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Middleware
 â”‚    â”œâ”€â”€ Auth
 â”‚    â”‚    â”œâ”€â”€ Jwt
 â”‚    â”‚    â”œâ”€â”€ Policies
 â”‚    â”‚    â”œâ”€â”€ Claims
 â”‚    â”‚    â”œâ”€â”€ Identity
 â”‚    â”‚    â”œâ”€â”€ Providers
 â”‚    â”‚    â””â”€â”€ Utils
 â”‚    â”‚
 â”‚    â”œâ”€â”€ ProblemDetails
 â”‚    â”‚    â”œâ”€â”€ Factory
 â”‚    â”‚    â”œâ”€â”€ Mapping
 â”‚    â”‚    â”œâ”€â”€ Models
 â”‚    â”‚    â”œâ”€â”€ Writers
 â”‚    â”‚    â””â”€â”€ Extensions
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Admin
 â”‚    â”‚    â”œâ”€â”€ Controllers
 â”‚    â”‚    â”œâ”€â”€ Services
 â”‚    â”‚    â”œâ”€â”€ Auth
 â”‚    â”‚    â”œâ”€â”€ DTOs
 â”‚    â”‚    â””â”€â”€ Filters
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Models
 â”‚    â”‚    â”œâ”€â”€ Requests
 â”‚    â”‚    â”œâ”€â”€ Responses
 â”‚    â”‚    â””â”€â”€ Bindings
 â”‚    â”‚
 â”‚    â””â”€â”€ Config
 â”‚         â”œâ”€â”€ Swagger
 â”‚         â”œâ”€â”€ Versioning
 â”‚         â”œâ”€â”€ Cors
 â”‚         â”œâ”€â”€ Json
 â”‚         â”œâ”€â”€ RateLimiting
 â”‚         â””â”€â”€ HealthChecks
 â”‚
 â”œâ”€â”€ Application
 â”‚    â”œâ”€â”€ DTOs
 â”‚    â”‚    â”œâ”€â”€ Requests
 â”‚    â”‚    â”œâ”€â”€ Responses
 â”‚    â”‚    â”œâ”€â”€ Shared
 â”‚    â”‚    â””â”€â”€ Profiles
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Mappers
 â”‚    â”‚    â”œâ”€â”€ Profiles
 â”‚    â”‚    â”œâ”€â”€ Converters
 â”‚    â”‚    â”œâ”€â”€ Resolvers
 â”‚    â”‚    â”œâ”€â”€ Transformers
 â”‚    â”‚    â”œâ”€â”€ Extensions
 â”‚    â”‚    â””â”€â”€ Config
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Interfaces
 â”‚    â”‚    â”œâ”€â”€ Repositories
 â”‚    â”‚    â”œâ”€â”€ Services
 â”‚    â”‚    â”œâ”€â”€ Messaging
 â”‚    â”‚    â”œâ”€â”€ External
 â”‚    â”‚    â””â”€â”€ Common
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Services
 â”‚    â”‚    â”œâ”€â”€ AppServices
 â”‚    â”‚    â”œâ”€â”€ CommandHandlers
 â”‚    â”‚    â”œâ”€â”€ QueryHandlers
 â”‚    â”‚    â”œâ”€â”€ Orchestrators
 â”‚    â”‚    â””â”€â”€ Decorators
 â”‚    â”‚
 â”‚    â”œâ”€â”€ UseCases
 â”‚    â”‚    â”œâ”€â”€ Commands
 â”‚    â”‚    â”œâ”€â”€ Queries
 â”‚    â”‚    â”œâ”€â”€ Events
 â”‚    â”‚    â””â”€â”€ Pipelines
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Validators
 â”‚    â”‚    â”œâ”€â”€ Features
 â”‚    â”‚    â”œâ”€â”€ Common
 â”‚    â”‚    â””â”€â”€ Pipeline
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Handlers
 â”‚    â”‚    â”œâ”€â”€ Commands
 â”‚    â”‚    â”œâ”€â”€ Queries
 â”‚    â”‚    â”œâ”€â”€ Notifications
 â”‚    â”‚    â”œâ”€â”€ Pipeline
 â”‚    â”‚    â””â”€â”€ Mappings
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Notifications
 â”‚    â”‚    â”œâ”€â”€ Events
 â”‚    â”‚    â”œâ”€â”€ Publishers
 â”‚    â”‚    â”œâ”€â”€ Handlers
 â”‚    â”‚    â”œâ”€â”€ Adapters
 â”‚    â”‚    â”œâ”€â”€ Outbox
 â”‚    â”‚    â””â”€â”€ Policies
 â”‚    â”‚
 â”‚    â””â”€â”€ Exceptions
 â”‚         â”œâ”€â”€ Types
 â”‚         â”œâ”€â”€ Mapping
 â”‚         â”œâ”€â”€ Translators
 â”‚         â”œâ”€â”€ Middleware
 â”‚         â”œâ”€â”€ Policies
 â”‚         â””â”€â”€ Codes
 â”‚
 â”œâ”€â”€ Domain
 â”‚    â”œâ”€â”€ Entities
 â”‚    â”œâ”€â”€ ValueObjects
 â”‚    â”œâ”€â”€ Services
 â”‚    â”œâ”€â”€ Events
 â”‚    â”œâ”€â”€ Specifications
 â”‚    â”œâ”€â”€ Exceptions
 â”‚    â””â”€â”€ Aggregates
 â”‚
 â”œâ”€â”€ Infrastructure
 â”‚    â”œâ”€â”€ Repositories
 â”‚    â”œâ”€â”€ Messaging
 â”‚    â”œâ”€â”€ Outbox
 â”‚    â”œâ”€â”€ Persistence
 â”‚    â””â”€â”€ Migrations
 â”‚
 â””â”€â”€ Worker
      â”œâ”€â”€ Jobs
      â””â”€â”€ Consumers


ðŸ“¦ src
 â”œâ”€â”€ Clients                          # Camada de clientes que consomem a API
 â”‚    â”œâ”€â”€ Web                         # AplicaÃ§Ã£o Web
 â”‚    â”œâ”€â”€ Mobile                      # Aplicativo Mobile
 â”‚    â””â”€â”€ Partner                     # IntegraÃ§Ãµes com sistemas/parceiros externos
 â”‚
 â”œâ”€â”€ Presentation                     # Camada de apresentaÃ§Ã£o (API / Controllers)
 â”‚    â”œâ”€â”€ Controllers                 # Endpoints HTTP expostos aos clientes
 â”‚    â”‚    â”œâ”€â”€ Users                  # Controladores de usuÃ¡rios
 â”‚    â”‚    â”œâ”€â”€ Expenses               # Controladores de despesas (sync/async)
 â”‚    â”‚    â”œâ”€â”€ Categories             # Controladores de categorias
 â”‚    â”‚    â”œâ”€â”€ Transactions           # Controladores de transaÃ§Ãµes financeiras
 â”‚    â”‚    â”œâ”€â”€ Auth                   # AutenticaÃ§Ã£o/autorizaÃ§Ã£o (login, tokens)
 â”‚    â”‚    â”œâ”€â”€ Admin                  # Endpoints administrativos (monitoramento, jobs)
 â”‚    â”‚    â””â”€â”€ Base                   # Controller base com helpers padrÃ£o
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Filters                     # Filtros globais de requisiÃ§Ã£o/resposta
 â”‚    â”‚    â”œâ”€â”€ ExceptionFilters        # Converte exceÃ§Ãµes em ProblemDetails
 â”‚    â”‚    â”œâ”€â”€ ValidationFilters       # ValidaÃ§Ã£o de inputs/DTOs
 â”‚    â”‚    â”œâ”€â”€ ActionFilters           # Logging e auditoria de aÃ§Ãµes
 â”‚    â”‚    â”œâ”€â”€ AuthorizationFilters    # Regras de autorizaÃ§Ã£o customizadas
 â”‚    â”‚    â””â”€â”€ ResultFilters           # Padroniza formato das respostas
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Middleware                  # Pipeline HTTP (logging, exceptions, tracing)
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Auth                        # ConfiguraÃ§Ã£o de autenticaÃ§Ã£o/autorizaÃ§Ã£o
 â”‚    â”‚    â”œâ”€â”€ Jwt                     # ConfiguraÃ§Ã£o JWT (tokens)
 â”‚    â”‚    â”œâ”€â”€ Policies                # Regras de acesso (roles, claims)
 â”‚    â”‚    â”œâ”€â”€ Claims                  # ExtensÃµes e tipos de claims
 â”‚    â”‚    â”œâ”€â”€ Identity                # IntegraÃ§Ã£o com ASP.NET Identity
 â”‚    â”‚    â”œâ”€â”€ Providers               # Login externo (Google, MS, Facebook)
 â”‚    â”‚    â””â”€â”€ Utils                   # Utilidades de seguranÃ§a (hash, validaÃ§Ã£o)
 â”‚    â”‚
 â”‚    â”œâ”€â”€ ProblemDetails              # PadronizaÃ§Ã£o de erros (RFC 7807)
 â”‚    â”‚    â”œâ”€â”€ Factory                 # CriaÃ§Ã£o de objetos ProblemDetails
 â”‚    â”‚    â”œâ”€â”€ Mapping                 # Mapeia exceptions â†’ problem types
 â”‚    â”‚    â”œâ”€â”€ Models                  # Estruturas extendidas de erros
 â”‚    â”‚    â”œâ”€â”€ Writers                 # Escrita serializada (JSON)
 â”‚    â”‚    â””â”€â”€ Extensions              # Helpers e extensÃµes de contexto
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Admin                       # APIs administrativas/operacionais
 â”‚    â”‚    â”œâ”€â”€ Controllers             # HealthCheck, Monitoramento, Jobs
 â”‚    â”‚    â”œâ”€â”€ Services                # ServiÃ§os de diagnÃ³stico e info de build
 â”‚    â”‚    â”œâ”€â”€ Auth                    # Regras extras de autenticaÃ§Ã£o admin
 â”‚    â”‚    â”œâ”€â”€ DTOs                    # Modelos de resposta de health/build
 â”‚    â”‚    â””â”€â”€ Filters                 # Auditoria de aÃ§Ãµes administrativas
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Models                      # Modelos de binding (entrada/saÃ­da da API)
 â”‚    â”‚    â”œâ”€â”€ Requests                # Modelos de entrada (POST/PUT)
 â”‚    â”‚    â”œâ”€â”€ Responses               # Modelos de saÃ­da (GET/DTOs de retorno)
 â”‚    â”‚    â””â”€â”€ Bindings                # Model binders customizados (arquivos, CSV)
 â”‚    â”‚
 â”‚    â””â”€â”€ Config                      # ConfiguraÃ§Ãµes auxiliares
 â”‚         â”œâ”€â”€ Swagger                 # DocumentaÃ§Ã£o OpenAPI
 â”‚         â”œâ”€â”€ Versioning              # Versionamento da API
 â”‚         â”œâ”€â”€ Cors                    # PolÃ­ticas CORS
 â”‚         â”œâ”€â”€ Json                    # SerializaÃ§Ã£o JSON
 â”‚         â”œâ”€â”€ RateLimiting            # Limite de requisiÃ§Ãµes
 â”‚         â””â”€â”€ HealthChecks            # ConfiguraÃ§Ã£o de health checks
 â”‚
 â”œâ”€â”€ Application                      # Camada de aplicaÃ§Ã£o (regras de orquestraÃ§Ã£o)
 â”‚    â”œâ”€â”€ DTOs                        # Objetos de transporte (entrada/saÃ­da)
 â”‚    â”‚    â”œâ”€â”€ Requests                # DTOs de entrada
 â”‚    â”‚    â”œâ”€â”€ Responses               # DTOs de saÃ­da
 â”‚    â”‚    â”œâ”€â”€ Shared                  # DTOs comuns/reutilizÃ¡veis
 â”‚    â”‚    â””â”€â”€ Profiles                # Perfis de mapeamento (AutoMapper)
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Mappers                     # ConversÃ£o entre DTOs e Entities
 â”‚    â”‚    â”œâ”€â”€ Profiles                # ConfiguraÃ§Ãµes de mapping
 â”‚    â”‚    â”œâ”€â”€ Converters              # ConversÃµes complexas
 â”‚    â”‚    â”œâ”€â”€ Resolvers               # Resolvedores de propriedades
 â”‚    â”‚    â”œâ”€â”€ Transformers            # TransformaÃ§Ãµes globais
 â”‚    â”‚    â”œâ”€â”€ Extensions              # MÃ©todos de extensÃ£o de mapping
 â”‚    â”‚    â””â”€â”€ Config                  # Registro de perfis
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Interfaces                  # Contratos da camada Application
 â”‚    â”‚    â”œâ”€â”€ Repositories            # Interfaces de persistÃªncia
 â”‚    â”‚    â”œâ”€â”€ Services                # Interfaces de serviÃ§os de aplicaÃ§Ã£o
 â”‚    â”‚    â”œâ”€â”€ Messaging               # Interfaces de mensageria
 â”‚    â”‚    â”œâ”€â”€ External                # IntegraÃ§Ãµes externas (gateways)
 â”‚    â”‚    â””â”€â”€ Common                  # Interfaces utilitÃ¡rias
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Services                    # ServiÃ§os de aplicaÃ§Ã£o
 â”‚    â”‚    â”œâ”€â”€ AppServices             # Orquestram casos de uso
 â”‚    â”‚    â”œâ”€â”€ CommandHandlers         # Manipulam Commands (escrita)
 â”‚    â”‚    â”œâ”€â”€ QueryHandlers           # Manipulam Queries (leitura)
 â”‚    â”‚    â”œâ”€â”€ Orchestrators           # Coordenam fluxos complexos
 â”‚    â”‚    â””â”€â”€ Decorators              # Cross-cutting concerns (logging, retry)
 â”‚    â”‚
 â”‚    â”œâ”€â”€ UseCases                    # Casos de uso especÃ­ficos
 â”‚    â”‚    â”œâ”€â”€ Commands                # AÃ§Ãµes de escrita (criar/atualizar/excluir)
 â”‚    â”‚    â”œâ”€â”€ Queries                 # Consultas/leitura
 â”‚    â”‚    â”œâ”€â”€ Events                  # Casos disparados por eventos
 â”‚    â”‚    â””â”€â”€ Pipelines               # Fluxos que agrupam mÃºltiplos casos
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Validators                  # ValidaÃ§Ã£o de DTOs e requests
 â”‚    â”‚    â”œâ”€â”€ Features                # Validadores por mÃ³dulo/feature
 â”‚    â”‚    â”œâ”€â”€ Common                  # Regras compartilhadas
 â”‚    â”‚    â””â”€â”€ Pipeline                # Behaviors de validaÃ§Ã£o em CQRS
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Handlers                    # Manipuladores CQRS
 â”‚    â”‚    â”œâ”€â”€ Commands                # Manipuladores de escrita
 â”‚    â”‚    â”œâ”€â”€ Queries                 # Manipuladores de leitura
 â”‚    â”‚    â”œâ”€â”€ Notifications           # Manipuladores de eventos
 â”‚    â”‚    â”œâ”€â”€ Pipeline                # Pipeline behaviors (validaÃ§Ã£o, log, retry)
 â”‚    â”‚    â””â”€â”€ Mappings                # AdaptaÃ§Ã£o Command/Query â‡„ DTO
 â”‚    â”‚
 â”‚    â”œâ”€â”€ Notifications               # Eventos/notificaÃ§Ãµes de aplicaÃ§Ã£o
 â”‚    â”‚    â”œâ”€â”€ Events                  # DefiniÃ§Ã£o dos eventos
 â”‚    â”‚    â”œâ”€â”€ Publishers              # Publicadores de eventos
 â”‚    â”‚    â”œâ”€â”€ Handlers                # Manipuladores dos eventos
 â”‚    â”‚    â”œâ”€â”€ Adapters                # AdaptaÃ§Ã£o de eventos de domÃ­nio
 â”‚    â”‚    â”œâ”€â”€ Outbox                  # ImplementaÃ§Ã£o do Outbox pattern
 â”‚    â”‚    â””â”€â”€ Policies                # PolÃ­ticas de retry, idempotÃªncia
 â”‚    â”‚
 â”‚    â””â”€â”€ Exceptions                  # ExceÃ§Ãµes de aplicaÃ§Ã£o
 â”‚         â”œâ”€â”€ Types                   # Tipos de exceÃ§Ãµes
 â”‚         â”œâ”€â”€ Mapping                 # Mapeamento para ProblemDetails
 â”‚         â”œâ”€â”€ Translators             # TraduÃ§Ã£o Domain/Infra â†’ Application
 â”‚         â”œâ”€â”€ Middleware              # Tratamento centralizado
 â”‚         â”œâ”€â”€ Policies                # PolÃ­ticas de erros
 â”‚         â””â”€â”€ Codes                   # CatÃ¡logo de cÃ³digos/mensagens
 â”‚
 â”œâ”€â”€ Domain                           # Camada de domÃ­nio (regras de negÃ³cio puras)
 â”‚    â”œâ”€â”€ Entities                    # Entidades com identidade prÃ³pria
 â”‚    â”œâ”€â”€ ValueObjects                # Objetos de valor (imutÃ¡veis, sem identidade)
 â”‚    â”œâ”€â”€ Services                    # ServiÃ§os de domÃ­nio (regras de negÃ³cio complexas)
 â”‚    â”œâ”€â”€ Events                      # Eventos de domÃ­nio
 â”‚    â”œâ”€â”€ Specifications              # Regras de negÃ³cio encapsuladas
 â”‚    â”œâ”€â”€ Exceptions                  # ExceÃ§Ãµes de domÃ­nio
 â”‚    â””â”€â”€ Aggregates                  # RaÃ­zes de agregados e seus limites
 â”‚
 â”œâ”€â”€ Infrastructure                   # Camada de infraestrutura (implementaÃ§Ãµes tÃ©cnicas)
 â”‚    â”œâ”€â”€ Repositories                # ImplementaÃ§Ã£o de repositÃ³rios (SQL/NoSQL/Procs)
 â”‚    â”œâ”€â”€ Messaging                   # ImplementaÃ§Ã£o de filas e mensageria
 â”‚    â”œâ”€â”€ Outbox                      # Processamento de mensagens persistidas (Outbox)
 â”‚    â”œâ”€â”€ Persistence                 # DbContext, conexÃµes, unidade de trabalho
 â”‚    â””â”€â”€ Migrations                  # Scripts/migraÃ§Ãµes de banco
 â”‚
 â””â”€â”€ Worker                           # Processos assÃ­ncronos / background
      â”œâ”€â”€ Jobs                        # Tarefas agendadas (limpeza, auditoria, batch)
      â””â”€â”€ Consumers                   # Consumidores de mensagens (RabbitMQ/Kafka)


```mermaid

%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  %% === Clientes ===
  subgraph Clients["Clients"]
    Web["Web App"]
    Mobile["Mobile App"]
    Partner["Parceiros"]
  end

  %% === API / Presentation ===
  subgraph Api["Presentation Layer (API)"]
    Controller["Controllers Auth/JWT ProblemDetails"]
  end

  %% === Core DDD ===
  subgraph DDD["Core Application (DDD)"]
    subgraph Application["Application Layer"]
      UseCases["UseCases"]
      Validators["FluentValidation"]
      DTOs["DTOs / Mappers"]
    end
    subgraph Domain["Domain Layer"]
      Entities["Entities / ValueObjects"]
      Services["Domain Services"]
    end
    subgraph Infrastructure["Infrastructure Layer"]
      Repos["Repositories (Procs)"]
      Messaging["Messaging (Producer/Consumer)"]
    end
  end

  %% === DB & Broker separados ===
  DB[(SQL Server Stored Procedures)]
  Broker{{Message Broker RabbitMQ / Kafka}}

  %% === Worker ===
  subgraph Worker["Worker Layer"]
    Jobs["Jobs (cleanup, audit, etc.)"]
    Consumer["Message Consumers"]
  end

  %% Fluxos principais
  Clients --> Api
  Api --> Application
  Application --> Domain
  Application --> Infrastructure

  %% Infra saÃ­das paralelas
  Infrastructure --> DB
  Infrastructure --> Broker

  %% Worker conexÃµes (sem cruzar)
  Worker --> DB
  Worker --> Broker


```

# Application Architecture

```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Application["Application Layer"]
    DTOs["DTOs Entrada/SaÃ­da de Dados Simples e sem lÃ³gica de negÃ³cio"]
    Mappers["Mappers ConversÃ£o DTO â‡„ Entities Isolamento entre camadas"]
    Interfaces["Interfaces Contratos p/ ServiÃ§os AbstraÃ§Ãµes p/ Domain/Infra"]
    Services["App Services Orquestram casos de uso Chama Domain & Infra Regras de aplicaÃ§Ã£o"]
    UseCases["UseCases Casos de Uso especÃ­ficos Fluxo de negÃ³cio orquestrado"]
    Validators["Validators (FluentValidation) ValidaÃ§Ã£o de DTOs e Requests"]
    Handlers["Handlers (Command/Query) Implementam CQRS IntegraÃ§Ã£o com Mediator"]
    Notifications["Notifications Mensagens de domÃ­nio convertidas p/ app NotificaÃ§Ã£o de erros ou eventos"]
    Exceptions["Exceptions Tratamento de falhas Regras de exceÃ§Ã£o de aplicaÃ§Ã£o"]
  end

```

# ðŸ“‚ Estrutura e responsabilidades da Application Layer

## DTOs â†’ Objetos de transporte, usados para entrada (requests) e saÃ­da (responses) da API. NÃ£o tÃªm lÃ³gica de negÃ³cio.

## Mappers â†’ Fazem a conversÃ£o entre DTOs e Entities (Domain). Garantem isolamento entre camadas.

## Interfaces â†’ Contratos de serviÃ§os, que podem ser implementados por Domain ou Infra.

## Services (Application Services) â†’ ContÃªm a lÃ³gica de orquestraÃ§Ã£o dos casos de uso, chamando Domain Services e Infra Repositories.

## UseCases â†’ Representam cenÃ¡rios de negÃ³cio especÃ­ficos (ex: Criar UsuÃ¡rio, Processar Pagamento).

## Validators (FluentValidation) â†’ ValidaÃ§Ã£o de DTOs e inputs antes de chegar ao Domain.

## Handlers (CQRS) â†’ ImplementaÃ§Ã£o de Commands (escrita) e Queries (leitura), geralmente integrados com MediatR.

## Notifications â†’ Canal para erros, warnings ou eventos que precisam ser propagados.

## Exceptions â†’ ExceÃ§Ãµes de aplicaÃ§Ã£o, isolando regras de erro que nÃ£o pertencem ao Domain.

# Dtos

```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph DTOs["Application/DTOs"]
    direction TB

    subgraph Requests["Requests"]
      R_desc["Entrada da API ValidaÃ§Ã£o antes do Domain Somente dados (sem regra)"]
      R_examples["Exemplos: CreateUserRequest UpdateExpenseRequest SearchExpenseRequest"]
    end

    subgraph Responses["Responses"]
      S_desc["SaÃ­da da API Modelos de retorno/paginaÃ§Ã£o Sem lÃ³gica de negÃ³cio"]
      S_examples["Exemplos: UserResponse ExpenseSummaryResponse PagedResultResponse"]
    end

    subgraph Shared["Shared / Common (opcional)"]
      Sh_desc["Tipos reutilizÃ¡veis EndereÃ§o, Documento, PaginaÃ§Ã£o, Filtros"]
      Sh_examples["Exemplos: AddressDto DocumentDto PaginationDto FilterDto"]
    end

    subgraph Profiles["Profiles / MappingConfig (opcional)"]
      P_desc["ConfiguraÃ§Ãµes de mapping (AutoMapper) Perfil por agregado / feature"]
      P_examples["Exemplos: UserProfile ExpenseProfile"]
    end
  end

  %% RelaÃ§Ãµes de uso
  Shared --> Requests
  Shared --> Responses
  Profiles --> Requests
  Profiles --> Responses
  Requests --> Responses

```

# Mappers

```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Mappers["Application/Mappers"]
    direction TB

    subgraph Profiles["Profiles"]
      P_desc["ConfiguraÃ§Ã£o de mapeamentos (AutoMapper) Agrupadas por agregado/feature Ex.: UserProfile, ExpenseProfile"]
    end

    subgraph Converters["Converters / TypeConverters"]
      C_desc["ConversÃµes complexas DTO â‡„ Entity Ex.: string â‡„ enum, normalizaÃ§Ã£o de datas"]
    end

    subgraph Resolvers["ValueResolvers / MemberValueResolvers"]
      R_desc["Regras para campos especÃ­ficos Ex.: compor NomeCompleto, calcular Status"]
    end

    subgraph Transformers["ValueTransformers (opcional)"]
      T_desc["TransformaÃ§Ãµes globais de tipo Ex.: trim em strings, UTC â‡„ LocalTime"]
    end

    subgraph Extensions["Extensions (opcional)"]
      E_desc["MÃ©todos de extensÃ£o p/ facilitar uso Ex.: obj.ToDto(), obj.ToEntity()"]
    end

    subgraph Config["MappingConfig / Registration"]
      MC_desc["Registro central do AutoMapper AddProfiles(), validaÃ§Ã£o de configuraÃ§Ã£o"]
    end
  end

  %% RelaÃ§Ãµes
  Profiles --> Converters
  Profiles --> Resolvers
  Profiles --> Transformers
  Extensions --> Profiles
  Config --> Profiles

```


# Interfaces
```mermaid


%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Interfaces["Application/Interfaces"]
    direction TB

    subgraph Repositories["Repositories"]
      R_desc["Contratos p/ acesso a dados Infra implementa Ex.: IUserRepository, IExpenseRepository"]
    end

    subgraph Services["Services"]
      S_desc["ServiÃ§os de aplicaÃ§Ã£o Usados pela API/Worker Ex.: IEmailService, INotificationService"]
    end

    subgraph Messaging["Messaging (opcional)"]
      M_desc["Contratos p/ mensageria Ex.: IMessageProducer, IMessageConsumer"]
    end

    subgraph External["External / Gateways (opcional)"]
      E_desc["Contratos p/ integraÃ§Ãµes externas Ex.: IPaymentGateway, IAuthProvider"]
    end

    subgraph Common["Common (opcional)"]
      C_desc["Interfaces utilitÃ¡rias/genÃ©ricas Ex.: IUnitOfWork, ILoggerAdapter"]
    end
  end

  %% RelaÃ§Ãµes
  Repositories --> Services
  Services --> Messaging
  Messaging --> External
  External --> Common
```

# Services
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Services["Application/Services"]
    direction TB

    subgraph AppServices["AppServices (Core)"]
      A_desc["Orquestram casos de uso Chamam Domain e Infra Ex.: UserAppService, ExpenseAppService"]
    end

    subgraph CommandHandlers["CommandHandlers (opcional)"]
      CH_desc["Manipulam Commands (escrita) Ex.: CreateUserCommandHandler, DeleteExpenseCommandHandler"]
    end

    subgraph QueryHandlers["QueryHandlers (opcional)"]
      QH_desc["Manipulam Queries (leitura) Ex.: GetUserByIdQueryHandler, GetExpensesByCategoryQueryHandler"]
    end

    subgraph Orchestrators["Orchestrators / Coordinators (opcional)"]
      O_desc["Coordenam fluxos complexos Ex.: CheckoutOrchestrator, ExpenseSyncCoordinator"]
    end

    subgraph Decorators["Decorators / Pipeline (opcional)"]
      D_desc["Cross-cutting concerns Ex.: Logging, Retry, Metrics"]
    end
  end

  %% RelaÃ§Ãµes
  AppServices --> CommandHandlers
  AppServices --> QueryHandlers
  AppServices --> Orchestrators
  AppServices --> Decorators
```

# UseCases
```mermaid

%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph UseCases["Application/UseCases"]
    direction TB

    subgraph Commands["Commands"]
      C_desc["Casos de uso de escrita Create, Update, Delete Ex.: CreateUserCommand, UpdateExpenseCommand"]
    end

    subgraph Queries["Queries"]
      Q_desc["Casos de uso de leitura Consultas e relatÃ³rios Ex.: GetUserByIdQuery, GetExpensesByCategoryQuery"]
    end

    subgraph Events["Events / Notifications (opcional)"]
      E_desc["Casos de uso disparados por eventos Ex.: UserCreatedEventHandler, ExpenseDeletedEventHandler"]
    end

    subgraph Pipelines["Pipelines / Interactors (opcional)"]
      P_desc["Fluxos compostos de mÃºltiplos casos de uso Ex.: CloseMonthInteractor"]
    end
  end

  %% RelaÃ§Ãµes
  Commands --> Queries
  Commands --> Events
  Queries --> Events
  Events --> Pipelines
```

# Validators
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Validators["Application/Validators"]
    direction TB

    subgraph Features["Features (por mÃ³dulo)"]
      UsersV["Users â€¢ CreateUserRequestValidator â€¢ UpdateUserRequestValidator"]
      ExpensesV["Expenses â€¢ CreateExpenseRequestValidator â€¢ UpdateExpenseRequestValidator"]
      CategoriesV["Categories â€¢ CreateCategoryRequestValidator"]
    end

    subgraph Common["Common / Shared"]
      Rules["Rules â€¢ Regras reutilizÃ¡veis â€¢ Ex.: CpfRule, EmailRule, MoneyRule"]
      Extensions["Extensions â€¢ MÃ©todos de extensÃ£o FluentValidation â€¢ Ex.: NotEmptyTrimmed(), ValidEnum()"]
      Messages["Messages / ErrorCodes â€¢ Mensagens padronizadas â€¢ Enum de cÃ³digos de erro"]
      Helpers["Helpers â€¢ Utilidades de validaÃ§Ã£o â€¢ NormalizaÃ§Ã£o, regex, datas"]
    end

    subgraph Pipeline["Pipeline (opcional)"]
      Behavior["ValidationBehavior<TReq,TRes> â€¢ Executa validaÃ§Ã£o antes do Handler â€¢ Agrega erros em ProblemDetails"]
      Adapt["Adapters (opcional) â€¢ Mapeia ValidationFailure â†’ Error DTO"]
    end
  end

  %% RelaÃ§Ãµes
  Common --> Features
  Pipeline --> Features
```

# Handlers
```mermaid

%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Handlers["Application/Handlers"]
    direction TB

    subgraph Commands["CommandHandlers (Escrita)"]
      C_desc["Manipulam Commands Create/Update/Delete TransaÃ§Ã£o + UoW Chamam Domain/Repos"]
      C_examples["Ex.: CreateUserCommandHandler UpdateExpenseCommandHandler DeleteCategoryCommandHandler"]
    end

    subgraph Queries["QueryHandlers (Leitura)"]
      Q_desc["Manipulam Queries Consultas otimizadas ProjeÃ§Ãµes para DTOs PaginaÃ§Ã£o/Filtros"]
      Q_examples["Ex.: GetUserByIdQueryHandler GetExpensesByCategoryQueryHandler ListTransactionsPagedHandler"]
    end

    subgraph Notifications["NotificationHandlers (Eventos)"]
      N_desc["Reagem a eventos (publish/subscribe) Side-effects: e-mail, auditoria, outbox IntegraÃ§Ã£o assÃ­ncrona"]
      N_examples["Ex.: UserCreatedNotificationHandler ExpenseDeletedNotificationHandler"]
    end

    subgraph Pipeline["PipelineBehaviors (opcional)"]
      PB_val["ValidationBehavior Valida Requests antes do Handler"]
      PB_log["LoggingBehavior MÃ©tricas/Tracing/CorrelationId"]
      PB_retry["RetryBehavior Polly/ResiliÃªncia (somente leitura ou idempotente)"]
      PB_perf["PerformanceBehavior Tempo por handler"]
    end

    subgraph Mappings["Mappings (opcional)"]
      MP_desc["Adaptadores entre Command/Query e DTOs NormalizaÃ§Ã£o/Enriquecimento de dados"]
    end
  end

  %% RelaÃ§Ãµes (opcional)
  Pipeline --> Commands
  Pipeline --> Queries
  Notifications --> Commands
  Notifications --> Queries
  Mappings --> Commands
  Mappings --> Queries


```

# Notifications
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Notifications["Application/Notifications"]
    direction TB

    subgraph Events["Events (Application/Domainâ†’App)"]
      E_desc["Contratos de eventos/notificaÃ§Ãµes Ex.: UserCreated, ExpenseDeleted"]
    end

    subgraph Publishers["Publishers"]
      P_desc["Publicam notificaÃ§Ãµes (in-proc via MediatR ou outbox â†’ broker) Ex.: NotificationPublisher"]
    end

    subgraph Handlers["Handlers"]
      H_desc["Reagem aos eventos (side-effects) Ex.: enviar e-mail, auditoria, projeÃ§Ãµes de leitura"]
    end

    subgraph Adapters["Adapters / Translators (opcional)"]
      A_desc["Mapeiam DomainEvent â†’ AppNotification Normalizam payloads para fila/API externa"]
    end

    subgraph Outbox["Outbox (opcional)"]
      O_desc["Tabela de saÃ­da transacional Processador de outbox para broker (Rabbit/Kafka)"]
    end

    subgraph Policies["Policies (opcional)"]
      PL_desc["Retry/Backoff/Dead-letter IdempotÃªncia e deduplicaÃ§Ã£o"]
    end
  end

  %% RelaÃ§Ãµes
  Events --> Publishers
  Publishers --> Handlers
  Adapters --> Publishers
  Outbox --> Publishers
  Policies --> Handlers
  Policies --> Publishers

  ```

  # Exceptions
  ```mermaid

%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Exceptions["Application/Exceptions"]
    direction TB

    subgraph Types["Types"]
      T_desc["Hierarquia de exceÃ§Ãµes de AplicaÃ§Ã£o â€¢ ApplicationException (base) â€¢ ValidationException â€¢ NotFoundException â€¢ ConflictException â€¢ UnauthorizedException â€¢ ForbiddenException â€¢ BusinessRuleException"]
    end

    subgraph Mapping["Mapping / ProblemDetails"]
      M_desc["Mapeia Exception â†’ ProblemDetails (RFC 7807) â€¢ status, type, title, detail, instance â€¢ errorCode, traceId, fieldErrors"]
    end

    subgraph Translators["Translators / Adapters"]
      TR_desc["DomainException â†’ ApplicationException InfraException â†’ ApplicationException NormalizaÃ§Ã£o e cÃ³digos"]
    end

    subgraph Middleware["Middleware / Filters"]
      MW_desc["ExceptionHandlingMiddleware ApiExceptionFilter (opcional) Oculta stack em produÃ§Ã£o"]
    end

    subgraph Policies["Policies (opcional)"]
      P_desc["Retryable vs NonRetryable IdempotÃªncia/CorrelationId Telemetria/Logging"]
    end

    subgraph Codes["ErrorCodes / Messages"]
      C_desc["Enum de cÃ³digos Mensagens padronizadas/i18n CatÃ¡logo de erros"]
    end
  end

  %% RelaÃ§Ãµes
  Types --> Mapping
  Translators --> Types
  Middleware --> Mapping
  Policies --> Middleware
  Codes --> Mapping

  ```

  # Presentation Layer
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Presentation["Presentation Layer (API)"]
    direction TB

    subgraph Controllers["Controllers"]
      C_desc["Expondo endpoints REST/GraphQL/gRPC Chamam Application Services ou Handlers Ex.: UserController, ExpenseController"]
    end

    subgraph Filters["Filters"]
      F_desc["Filtros de aÃ§Ã£o e exceÃ§Ã£o Ex.: ApiExceptionFilter, ValidationFilter"]
    end

    subgraph Middleware["Middleware"]
      M_desc["Pipeline HTTP (Request â†’ Response) Ex.: ExceptionHandlingMiddleware, CorrelationIdMiddleware"]
    end

    subgraph Auth["Auth / Security"]
      A_desc["AutenticaÃ§Ã£o e AutorizaÃ§Ã£o Ex.: JWT Bearer, OAuth2, AuthorizationPolicies"]
    end

    subgraph ProblemDetails["ProblemDetails / Error Handling"]
      PD_desc["PadrÃ£o RFC 7807 Mapeamento de exceÃ§Ãµes p/ HTTP Ex.: ProblemDetailsFactory, ValidationProblemDetails"]
    end

    subgraph Config["Config"]
      Co_desc["ConfiguraÃ§Ãµes auxiliares da API Ex.: SwaggerConfig, ApiVersioningConfig"]
    end
  end

  %% RelaÃ§Ãµes
  Controllers --> Filters
  Controllers --> Middleware
  Controllers --> Auth
  Controllers --> ProblemDetails
  Controllers --> Config
```

# Controller
```mermaid  

%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Controllers["Presentation/Controllers"]
    direction TB

    subgraph Users["Users"]
      U_desc["UserController CRUD de usuÃ¡rios GestÃ£o de perfis e permissÃµes"]
    end

    subgraph Expenses["Expenses"]
      E_sync["ExpenseControllerSync OperaÃ§Ãµes sÃ­ncronas (REST direto)"]
      E_async["ExpenseControllerAsync OperaÃ§Ãµes assÃ­ncronas (mensageria, fila)"]
    end

    subgraph Categories["Categories"]
      C_desc["CategoryController GestÃ£o de categorias de despesas"]
    end

    subgraph Transactions["Transactions"]
      T_desc["TransactionController Gerencia transaÃ§Ãµes financeiras Ex.: registrar, listar, consultar"]
    end

    subgraph Auth["Auth / Identity"]
      A_auth["AuthController Login, RefreshToken, Logout"]
      A_account["AccountController Cadastro e gerenciamento de contas"]
    end

    subgraph Admin["Admin / Management"]
      Adm_sys["SystemController Status do sistema, health check"]
      Adm_mon["MonitoringController Logs, mÃ©tricas, auditoria"]
    end

    subgraph Base["Base (opcional)"]
      B_base["ApiControllerBase Helper p/ respostas padronizadas Ex.: Ok(), Problem(), CreatedAt()"]
    end
  end
```

# Filters
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Filters["Presentation/Filters"]
    direction TB

    subgraph ExceptionFilters["ExceptionFilters"]
      Ex1["ApiExceptionFilter Captura exceÃ§Ãµes â†’ ProblemDetails"]
      Ex2["DomainExceptionFilter DomainException â†’ ApplicationException"]
    end

    subgraph ValidationFilters["ValidationFilters"]
      V1["ValidationFilter Valida ModelState/DTOs Integra FluentValidation"]
    end

    subgraph ActionFilters["ActionFilters"]
      A1["LoggingActionFilter Log de requests/responses"]
      A2["AuditActionFilter Auditoria de chamadas crÃ­ticas"]
    end

    subgraph AuthorizationFilters["AuthorizationFilters"]
      AU1["RoleAuthorizationFilter Regras customizadas de roles/policies"]
    end

    subgraph ResultFilters["ResultFilters"]
      R1["ResponseWrapperFilter Padroniza formato de resposta (ex.: envelopar em { data, errors })"]
    end
  end
```

# Middleware
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Middleware["Presentation/Middleware"]
    direction TB

    Ex["ExceptionHandlingMiddleware Captura exceÃ§Ãµes globais â†’ ProblemDetails"]
    Corr["CorrelationIdMiddleware Gera e propaga CorrelationId p/ rastreamento"]
    Log["LoggingMiddleware Log de Request/Response + MÃ©tricas bÃ¡sicas"]
    Time["RequestTimingMiddleware Mede tempo de execuÃ§Ã£o + Telemetria/Tracing"]
    Auth["AuthenticationMiddleware (opcional) AutenticaÃ§Ã£o customizada/OAuth2"]
    Rate["RateLimitingMiddleware (opcional) Controle de chamadas Throttling/Quota"]
    Cache["CachingMiddleware (opcional) Cache de respostas"]
    Sec["SecurityHeadersMiddleware (opcional) Headers de seguranÃ§a: CSP, CORS, HSTS"]
  end

  ```

  # Auth / Security
```mermaid
  %%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Auth["Presentation/Auth"]
    direction TB

    subgraph Jwt["JWT"]
      J1["JwtAuthenticationConfig ConfiguraÃ§Ãµes (Issuer, Audience, SigningKey)"]
      J2["JwtTokenService GeraÃ§Ã£o e validaÃ§Ã£o de tokens"]
      J3["JwtBearerEventsHandler Eventos do pipeline JWT (OnTokenValidated etc.)"]
    end

    subgraph Policies["Authorization Policies"]
      P1["AuthorizationPolicies Regras baseadas em Roles/Claims/Scopes"]
      P2["PolicyNames Constantes com nomes de polÃ­ticas"]
    end

    subgraph Claims["Claims"]
      C1["ClaimsExtensions Helpers p/ extrair claims do usuÃ¡rio"]
      C2["ClaimTypesCustom DefiniÃ§Ã£o de claims customizadas"]
    end

    subgraph Identity["Identity (opcional)"]
      I1["IdentityConfig ConfiguraÃ§Ã£o ASP.NET Identity"]
      I2["ApplicationUser UsuÃ¡rio customizado com propriedades extras"]
    end

    subgraph Providers["External Providers (opcional)"]
      PR1["OAuth2ProviderConfig IntegraÃ§Ã£o com Google, Microsoft, Facebook"]
      PR2["ExternalLoginService ServiÃ§o de login via provedores externos"]
    end

    subgraph Utils["Utils"]
      U1["PasswordHasher Hash/Salt seguro p/ senhas"]
      U2["TokenValidationParametersFactory ConfiguraÃ§Ã£o centralizada p/ validaÃ§Ã£o de tokens"]
    end
  end
  ```
  # ProblemDetails
  ```mermaid
  %%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph ProblemDetails["Presentation/ProblemDetails"]
    direction TB

    subgraph Factory["Factory"]
      F1["ProblemDetailsFactory Cria ProblemDetails/ValidationProblemDetails"]
      F2["ProblemDetailsOptions Mapa statusâ†’type/title, env, links"]
    end

    subgraph Mapping["Mapping"]
      M1["ExceptionToProblemDetailsMapper Exception â†’ ProblemDetails"]
      M2["ErrorCodeToProblemTypeMapper ErrorCode â†’ type (URI), title"]
    end

    subgraph Models["Models"]
      Md1["ExtendedProblemDetails + traceId, errorCode, instance, details"]
      Md2["ValidationProblemDetailsEx + fieldErrors (FluentValidation)"]
    end

    subgraph Writers["Writers"]
      W1["ProblemDetailsWriter SerializaÃ§Ã£o: content-type, casing, RFC7807"]
    end

    subgraph Extensions["Extensions"]
      E1["HttpContextProblemExtensions Add traceId/instance/links"]
      E2["ProblemDetailsExtensions Append metadados/cÃ³digos"]
    end
  end

  %% RelaÃ§Ãµes
  Factory --> Mapping
  Mapping --> Models
  Writers --> Models
  Extensions --> Factory
  Extensions --> Writers

  ```

  # Admin / Management
  ```mermaid
  %%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Admin["Presentation/Admin"]
    direction TB

    subgraph Controllers["Controllers"]
      Sys["SystemController Health, uptime, build info"]
      Mon["MonitoringController MÃ©tricas/Tracing/Logs (views)"]
      Dia["DiagnosticsController Dumps, threads, GC (restrito)"]
      Jobs["JobsController Disparo de jobs/reprocessos (auditado)"]
    end

    subgraph Services["Services"]
      Hc["HealthCheckService Aggrega IHealthChecks e dependÃªncias"]
      Dx["DiagnosticsService GC/Threads/Memory/Process info"]
      Build["BuildInfoProvider VersÃ£o/commit/data/env"]
    end

    subgraph Auth["Auth"]
      Pol["AdminAuthorizationPolicy Role/Claim obrigatÃ³ria"]
      Key["ApiKeyValidator (opcional) Dupla verificaÃ§Ã£o p/ rotas sensÃ­veis"]
    end

    subgraph DTOs["DTOs"]
      Hdto["HealthReportDto"]
      Bdto["BuildInfoDto"]
      Jreq["JobTriggerRequest"]
    end

    subgraph Filters["Filters"]
      Aud["AdminAuditActionFilter Auditoria de aÃ§Ãµes administrativas"]
    end
  end

  %% RelaÃ§Ãµes
  Controllers --> Services
  Controllers --> Auth
  Controllers --> DTOs
  Controllers --> Filters
  ```

# Models

```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Models["Presentation/Models"]
    direction TB

    subgraph Requests["Requests"]
      R_auth["Auth LoginModel RefreshTokenModel"]
      R_users["Users CreateUserModel UpdateUserModel"]
      R_exp["Expenses CreateExpenseModel ImportExpensesCsvModel"]
      R_common["Common PaginationModel DateRangeModel"]
    end

    subgraph Responses["Responses"]
      S_users["Users UserViewModel"]
      S_exp["Expenses ExpenseViewModel ExpenseSummaryViewModel"]
      S_common["Common PagedResultModel"]
    end

    subgraph Bindings["Bindings (opcional)"]
      B_custom["CustomModelBinders Enums, datas, CSV"]
      B_multipart["MultipartFormBinders Upload de arquivos"]
    end
  end

  %% RelaÃ§Ãµes
  Requests --> Responses
  Bindings --> Requests
  ```

  # Config
  ```mermaid
  %%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Config["Presentation/Config"]
    direction TB

    subgraph Swagger["Swagger / OpenAPI"]
      Sw1["SwaggerConfig Setup UI/Docs"]
      Sw2["SwaggerAuthConfig JWT/OAuth2 no Swagger"]
    end

    subgraph Versioning["Versioning"]
      V1["ApiVersioningConfig Configura versÃµes v1, v2..."]
      V2["ApiExplorerConfig Integra com Swagger"]
    end

    subgraph Cors["CORS"]
      C1["CorsConfig Define polÃ­ticas de origem"]
    end

    subgraph Json["JSON Serialization"]
      J1["JsonOptionsConfig Config System.Text.Json/Newtonsoft"]
      J2["ProblemDetailsConfig Config RFC7807 p/ erros"]
    end

    subgraph Rate["RateLimiting (opcional)"]
      R1["RateLimitingConfig RestriÃ§Ã£o de requisiÃ§Ãµes"]
    end

    subgraph Health["HealthChecks (opcional)"]
      H1["HealthChecksConfig Registra checks p/ readiness/liveness"]
    end
  end
  ```

  # Domain Layer
```mermaid
  %%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  subgraph Domain["Domain Layer"]
    direction TB

    subgraph Entities["Entities"]
      E1["User"]
      E2["Expense"]
      E3["Transaction"]
      E4["Category"]
    end

    subgraph ValueObjects["ValueObjects"]
      V1["Money"]
      V2["Email"]
      V3["Document (CPF/CNPJ)"]
      V4["DateRange"]
    end

    subgraph Services["Domain Services"]
      S1["ExpenseDomainService"]
      S2["TransactionDomainService"]
    end

    subgraph Events["Domain Events"]
      Ev1["UserCreatedDomainEvent"]
      Ev2["ExpenseDeletedDomainEvent"]
    end

    subgraph Specifications["Specifications (opcional)"]
      Sp1["ExpenseOverLimitSpec"]
      Sp2["ActiveUserSpec"]
    end

    subgraph Exceptions["Exceptions"]
      Ex1["DomainException"]
      Ex2["InvalidMoneyException"]
    end

    subgraph Aggregates["Aggregates"]
      Ag1["ExpenseAggregate"]
      Ag2["TransactionAggregate"]
    end
  end

  %% RelaÃ§Ãµes
  Entities --> ValueObjects
  Entities --> Events
  Aggregates --> Entities
  Services --> Entities
  Services --> ValueObjects
  Specifications --> Entities
  Exceptions --> Entities
  
  ```

  # resumo
```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
flowchart TB

  %% ==== Clients ====
  subgraph Clients["Clients"]
    direction TB
    Web["Web App"]
    Mobile["Mobile App"]
    Partner["Parceiros"]
  end

  %% ==== Presentation Layer ====
  subgraph Presentation["Presentation Layer (API)"]
    direction TB

    subgraph Controllers["Controllers"]
      C_Users["Users UserController"]
      C_Expenses["Expenses ExpenseControllerSync ExpenseControllerAsync"]
      C_Categories["Categories CategoryController"]
      C_Transactions["Transactions TransactionController"]
      C_Auth["Auth AuthController AccountController"]
      C_Admin["Admin SystemController MonitoringController DiagnosticsController JobsController"]
      C_Base["Base (opcional) ApiControllerBase"]
    end

    subgraph Filters["Filters"]
      F_Exception["ExceptionFilters ApiExceptionFilter DomainExceptionFilter"]
      F_Validation["ValidationFilters ValidationFilter"]
      F_Action["ActionFilters LoggingActionFilter AuditActionFilter"]
      F_Author["AuthorizationFilters RoleAuthorizationFilter"]
      F_Result["ResultFilters ResponseWrapperFilter"]
    end

    subgraph Middleware["Middleware"]
      MW_Exception["ExceptionHandlingMiddleware"]
      MW_Corr["CorrelationIdMiddleware"]
      MW_Log["LoggingMiddleware"]
      MW_Time["RequestTimingMiddleware"]
      MW_Auth["AuthenticationMiddleware (opcional)"]
      MW_Rate["RateLimitingMiddleware (opcional)"]
      MW_Cache["CachingMiddleware (opcional)"]
      MW_Sec["SecurityHeadersMiddleware (opcional)"]
    end

    subgraph Auth["Auth / Security"]
      A_Jwt["JWT JwtAuthenticationConfig JwtTokenService JwtBearerEventsHandler"]
      A_Policies["Policies AuthorizationPolicies PolicyNames"]
      A_Claims["Claims ClaimsExtensions ClaimTypesCustom"]
      A_Identity["Identity (opcional) IdentityConfig ApplicationUser"]
      A_Providers["External Providers (opcional) OAuth2ProviderConfig ExternalLoginService"]
      A_Utils["Utils PasswordHasher TokenValidationParametersFactory"]
    end

    subgraph ProblemDetails["ProblemDetails (RFC 7807)"]
      PD_Factory["Factory ProblemDetailsFactory ProblemDetailsOptions"]
      PD_Mapping["Mapping ExceptionToProblemDetailsMapper ErrorCodeToProblemTypeMapper"]
      PD_Models["Models ExtendedProblemDetails ValidationProblemDetailsEx"]
      PD_Writers["Writers ProblemDetailsWriter"]
      PD_Ext["Extensions HttpContextProblemExtensions ProblemDetailsExtensions"]
    end

    subgraph Admin["Admin"]
      ADT_DTOs["DTOs HealthReportDto BuildInfoDto JobTriggerRequest"]
      ADT_Services["Services HealthCheckService DiagnosticsService BuildInfoProvider"]
      ADT_Auth["Auth AdminAuthorizationPolicy ApiKeyValidator"]
      ADT_Filters["Filters AdminAuditActionFilter"]
    end

    subgraph Models["Models (opcional)"]
      M_Req["Requests Auth: LoginModel, RefreshTokenModel Users: Create/UpdateUserModel Expenses: CreateExpenseModel, ImportExpensesCsvModel Common: PaginationModel, DateRangeModel"]
      M_Res["Responses Users: UserViewModel Expenses: ExpenseViewModel, ExpenseSummaryViewModel Common: PagedResultModel"]
      M_Bind["Bindings CustomModelBinders MultipartFormBinders"]
    end

    subgraph Config["Config"]
      CFG_Swagger["Swagger SwaggerConfig SwaggerAuthConfig"]
      CFG_Version["Versioning ApiVersioningConfig ApiExplorerConfig"]
      CFG_Cors["CORS CorsConfig"]
      CFG_Json["JSON JsonOptionsConfig ProblemDetailsConfig"]
      CFG_Rate["RateLimiting (opcional) RateLimitingConfig"]
      CFG_Health["HealthChecks (opcional) HealthChecksConfig"]
    end
  end

  %% ==== Application Layer ====
  subgraph Application["Application Layer"]
    direction TB

    subgraph DTOs["DTOs"]
      D_Req["Requests"]
      D_Res["Responses"]
      D_Shared["Shared / Common"]
      D_Profiles["Profiles / MappingConfig (opcional)"]
    end

    subgraph Mappers["Mappers"]
      MAP_Profiles["Profiles"]
      MAP_Conv["Converters / TypeConverters"]
      MAP_Res["Resolvers"]
      MAP_Transf["Transformers (opcional)"]
      MAP_Ext["Extensions (opcional)"]
      MAP_Config["MappingConfig / Registration"]
    end

    subgraph Interfaces["Interfaces"]
      I_Repos["Repositories"]
      I_Services["Services"]
      I_Msg["Messaging (opcional)"]
      I_Ext["External / Gateways (opcional)"]
      I_Common["Common (opcional) IUnitOfWork ILoggerAdapter"]
    end

    subgraph Services["Services"]
      S_App["AppServices (Core)"]
      S_CmdH["CommandHandlers (opcional)"]
      S_QryH["QueryHandlers (opcional)"]
      S_Orch["Orchestrators (opcional)"]
      S_Deco["Decorators / Pipeline (opcional)"]
    end

    subgraph UseCases["UseCases"]
      UC_Cmd["Commands"]
      UC_Qry["Queries"]
      UC_Evt["Events / Notifications (opcional)"]
      UC_Pipe["Pipelines / Interactors (opcional)"]
    end

    subgraph Validators["Validators"]
      V_Features["Features (por mÃ³dulo) Users/Expenses/Categories ..."]
      V_Common["Common / Shared Rules Extensions Messages Helpers"]
      V_Beh["Pipeline (opcional) ValidationBehavior ValidationFailureAdapter"]
    end

    subgraph Handlers["Handlers (CQRS)"]
      H_Cmd["CommandHandlers (Escrita)"]
      H_Qry["QueryHandlers (Leitura)"]
      H_Notif["NotificationHandlers (Eventos)"]
      H_Pipe["PipelineBehaviors (opcional) Validation/Logging/Retry/Performance"]
      H_Map["Mappings (opcional)"]
    end

    subgraph Notifications["Notifications"]
      N_Evt["Events"]
      N_Pub["Publishers"]
      N_Hdl["Handlers"]
      N_Adp["Adapters / Translators (opcional)"]
      N_Out["Outbox (opcional)"]
      N_Pol["Policies (opcional)"]
    end

    subgraph Exceptions["Exceptions"]
      E_Types["Types ApplicationException base Validation/NotFound/Conflict/Unauthorized/Forbidden/BusinessRule"]
      E_Map["Mapping / ProblemDetails"]
      E_Tr["Translators Domain/Infra â†’ Application"]
      E_MW["Middleware / Filters"]
      E_Pol["Policies (opcional)"]
      E_Codes["ErrorCodes / Messages"]
    end
  end

  %% ==== Domain Layer ====
  subgraph Domain["Domain Layer"]
    direction TB
    D_Entities["Entities User Expense Transaction Category"]
    D_VO["ValueObjects Money Email Document (CPF/CNPJ) DateRange"]
    D_Services["Domain Services ExpenseDomainService TransactionDomainService"]
    D_Events["Domain Events UserCreatedDomainEvent ExpenseDeletedDomainEvent"]
    D_Specs["Specifications (opcional) ExpenseOverLimitSpec ActiveUserSpec"]
    D_Ex["Exceptions DomainException InvalidMoneyException"]
    D_Agg["Aggregates ExpenseAggregate TransactionAggregate"]
  end

  %% ==== Infrastructure Layer ====
  subgraph Infrastructure["Infrastructure Layer"]
    direction TB
    INF_Repos["Repositories (Procs/Dapper/EF) ImplementaÃ§Ãµes de I*Repository SQL/Stored Procedures"]
    INF_Msg["Messaging Producer/Consumer Config de filas"]
    INF_Outbox["Outbox Processor"]
    INF_Persist["Persistence DbContext/Connections"]
    INF_Migr["Migrations / Scripts"]
  end

  %% ==== Worker Layer ====
  subgraph Worker["Worker Layer"]
    direction TB
    W_Jobs["Jobs cleanup audit rotinas"]
    W_Consumers["Message Consumers (assÃ­ncrono)"]
  end

  %% ==== Recursos Externos ====
  DB[(SQL Server Stored Procedures)]
  Broker{{Message Broker RabbitMQ / Kafka}}

  %% ==== Fluxos ====
  Clients --> Presentation
  Presentation --> Application
  Application --> Domain
  Application --> Infrastructure
  Infrastructure --> DB
  Infrastructure --> Broker
  Worker --> DB
  Worker --> Broker
```